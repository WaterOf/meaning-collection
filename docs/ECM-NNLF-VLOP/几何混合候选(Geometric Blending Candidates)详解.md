几何混合候选是视频编码中一种先进的帧间预测技术，主要用于高效地表示复杂运动场景。下面我将从多个角度详细解释这一概念。
[[几何混合候选(Geometric Blending Candidates)详解]]
## 基本概念

几何混合候选是一种将**两个不同的运动预测**通过**几何分割**和**加权混合**的方式组合起来的预测方法。它能够更好地处理以下情况：
- 物体边缘的复杂运动
- 部分遮挡区域
- 不同运动方向的区域交界处

## 技术原理

1. **双预测候选组合**：
   - 同时考虑两个不同的运动向量候选（通常来自不同的参考方向）
   - 例如：一个来自前向参考帧(L0)，一个来自后向参考帧(L1)

2. **几何分割**：
   - 将预测块划分为两个区域（通常使用直线分割）
   - 每个区域使用不同的运动预测

3. **加权混合**：
   - 在分割边界附近进行平滑过渡
   - 避免明显的拼接痕迹

## 实现细节

### 1. 候选生成
代码中的`getGeoBlendCand`函数主要完成以下工作：
```cpp
// 从两个方向的候选列表中生成候选对
for (uint8_t mergeCand = 0; mergeCand < maxNumMergeCandidates; mergeCand++) {
    if (mrgDuplicated[mergeCand]) continue;
    // 根据方向(L0/L1/双向)分类候选
}
```

### 2. 候选评估
每个候选对通过以下步骤评估：
```cpp
// 计算模板匹配代价
Distortion uiCostTmp = deriveBcwBlendingBiDir(*cu.firstPU, mvFieldA, mvFieldB);
```

### 3. 几何混合参数
`GeoBlendInfo`结构体包含混合所需的所有参数：
```cpp
struct GeoBlendInfo {
    MvField mvFieldA[2]; // 第一个候选的运动向量
    MvField mvFieldB[2]; // 第二个候选的运动向量
    Distortion uiCostTmp; // 代价估计
    // 其他混合参数...
};
```

## 优势与应用

1. **高效表示复杂运动**：
   - 比传统双向预测更能准确表示物体边缘运动
   - 特别适合旋转、缩放等非平移运动

2. **编码效率提升**：
   - 减少预测残差能量
   - 降低码率需求

3. **硬件友好实现**：
   - 基于现有运动补偿流程
   - 只需增加混合处理模块

## 实际应用示例

假设编码一个旋转的风扇：
1. 传统双向预测难以准确表示叶片运动
2. 几何混合可以：
   - 使用一个候选表示叶片根部运动
   - 另一个候选表示叶片尖端运动
   - 通过几何分割自然混合两种运动

## 与其他技术的关系

1. **与常规Merge模式比较**：
   - 常规Merge只能使用单一运动向量
   - 几何混合允许局部不同的运动

2. **与Affine运动补偿比较**：
   - Affine表示连续变化的运动场
   - 几何混合是分段近似，计算更简单

3. **与OBMC(重叠块运动补偿)比较**：
   - 都是混合不同预测
   - 几何混合基于几何分割，OBMC基于固定权重

## 总结

几何混合候选技术通过智能组合多个运动预测，显著提升了视频编码器对复杂运动的表示能力。其核心价值在于：

1. **更精确的预测** → 更小的残差 → 更高的压缩效率
2. **保持较低的计算复杂度**，适合实时编码
3. **向后兼容**，可集成到现有编码框架中

这项技术在现代视频编码标准(如H.266/VVC)中发挥着重要作用，特别是在高动态运动场景的编码优化中表现突出。